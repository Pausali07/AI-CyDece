#!/usr/bin/env python3
# Minimal socket-based SSH-like honeypot (lab use only)
import socket, threading, os, time, json
from datetime import datetime

HOST = "0.0.0.0"
PORT = int(os.environ.get("HP_PORT", 2222))
LOG_DIR = os.environ.get("HP_LOG_DIR", "/var/honeypot/logs")
BANNER = os.environ.get("HP_BANNER", "SSH-2.0-OpenSSH_7.4p1\r\n")

os.makedirs(LOG_DIR, exist_ok=True)

def ts(): return datetime.utcnow().isoformat()+"Z"

def write_session(session):
    path = os.path.join(LOG_DIR, f"{session['id']}.json")
    try:
        with open(path, "w") as f:
            json.dump(session, f, indent=2)
    except Exception as e:
        print("Failed to write session:", e)

def handle_client(conn, addr):
    client_ip, client_port = addr[0], a
